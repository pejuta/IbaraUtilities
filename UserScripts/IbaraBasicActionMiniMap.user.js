// ==UserScript==
// @name         IbaraBasicActionMiniMap
// @namespace    https://twitter.com/11powder
// @version      0.1.8
// @description  マップ上にあなたの現在位置を表示します。
// @include      /^http:\/\/lisge\.com\/ib\/act_main\.php.*?$/
// @updateURL    https://pejuta.github.io/IbaraUtilities/UserScripts/IbaraBasicActionMiniMap.user.js
// @downloadURL  https://pejuta.github.io/IbaraUtilities/UserScripts/IbaraBasicActionMiniMap.user.js
// @grant        none
// ==/UserScript==
!function(t){var n={};function r(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=n,r.d=function(t,n,e){r.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:e})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,n){if(1&n&&(t=r(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(r.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var a in t)r.d(e,a,function(n){return t[n]}.bind(null,a));return e},r.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(n,"a",n),n},r.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},r.p="",r(r.s=1)}([function(t,n){t.exports='<link rel="stylesheet" type="text/css" href="https://dl.dropboxusercontent.com/s/ajarfqhw8a1cx28/minimap.css" />\r\n<div id="MiniMapCnt">\r\n    <table id="MiniMap">\r\n        <tbody>\r\n        <tr>\r\n            <td><a href="http://lisge.com/ib/k/now/map1.html" target="_blank"><img src="./p/hazamap1.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map2.html" target="_blank"><img src="./p/hazamap2.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map3.html" target="_blank"><img src="./p/hazamap3.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map4.html" target="_blank"><img src="./p/hazamap4.png"></a></td>\r\n        </tr>\r\n        <tr>\r\n            <td><a href="http://lisge.com/ib/k/now/map5.html" target="_blank"><img src="./p/hazamap5.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map6.html" target="_blank"><img src="./p/hazamap6.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map7.html" target="_blank"><img src="./p/hazamap7.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map8.html" target="_blank"><img src="./p/hazamap8.png"></a></td>\r\n        </tr>\r\n        <tr>\r\n            <td><a href="http://lisge.com/ib/k/now/map9.html" target="_blank"><img src="./p/hazamap9.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map10.html" target="_blank"><img src="./p/hazamap10.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map11.html" target="_blank"><img src="./p/hazamap11.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map12.html" target="_blank"><img src="./p/hazamap12.png"></a></td>\r\n        </tr>\r\n        <tr>\r\n            <td><a href="http://lisge.com/ib/k/now/map13.html" target="_blank"><img src="./p/hazamap13.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map14.html" target="_blank"><img src="./p/hazamap14.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map15.html" target="_blank"><img src="./p/hazamap15.png"></a></td>\r\n            <td><a href="http://lisge.com/ib/k/now/map16.html" target="_blank"><img src="./p/hazamap16.png"></a></td>\r\n        </tr>\r\n        </tbody>\r\n    </table>\r\n    <div id="CntCourse">\r\n        <div class="MapCourse">\r\n            <span class="MapCourseIco"></span>\r\n            <div class="MapCourse">\r\n                <span class="MapCourseIco"></span>\r\n                <div class="MapCourse">\r\n                    <span class="MapCourseIco"></span>\r\n                    <div class="MapCourse">\r\n                        <span class="MapCourseIco"></span>\r\n                        <div class="MapCourse">\r\n                            <span class="MapCourseIco"></span>\r\n                            <div class="MapCourse">\r\n                                <span class="MapCourseIco Goal"></span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div id="MapShadow"></div>\r\n</div>'},function(t,n,r){"use strict";r.r(n);var e,a=r(0),o=r.n(a),i=(r(2),function(t,n,r,e){return new(r||(r=Promise))((function(a,o){function i(t){try{p(e.next(t))}catch(t){o(t)}}function s(t){try{p(e.throw(t))}catch(t){o(t)}}function p(t){var n;t.done?a(t.value):(n=t.value,n instanceof r?n:new r((function(t){t(n)}))).then(i,s)}p((e=e.apply(t,n||[])).next())}))});e=window.jQuery,i(void 0,void 0,void 0,(function*(){class t{constructor(n,r,e){this.div=n,this.divIdx=t.getDivisionIndexByName(n),this.x=r.charCodeAt(0)-65,this.y=parseInt(e,10)-1}static parse(n){const r=/(^.+)区([A-Z])-(\d{1,2})$/.exec(n);if(null===r)throw new Error("位置情報テキストが正常に解析できませんでした。");return new t(r[1],r[2],r[3])}static getDivisionIndexByName(n){return t.divht[n]||-1}toString(){return`${this.div}区${String.fromCharCode(this.x+65)}-${this.y+1}`}}function n(){return i(this,void 0,void 0,(function*(){const n=/^(.+?)区 ([A-Z])(\d{1,2})/.exec(e("select[name='dt_taxi']>option:selected").text());return null!==n?new t(n[1],n[2],n[3]):yield function(){return i(this,void 0,void 0,(function*(){const n=function(){const t=/IBR_KEY=.+?_(\d+)(?:;|$)/.exec(document.cookie);return null===t?-1:parseInt(t[1],10)}();if(-1===n)return null;const r=yield e.ajax({type:"GET",dataType:"text",url:`http://lisge.com/ib/k/now/r${n}.html`}),a=document.implementation.createHTMLDocument();return t.parse(e(r,a).find("div.CIMGNM4").text())}))}()}))}function r(){return i(this,void 0,void 0,(function*(){const t=yield n();null!==t&&e("#MiniMap").css({left:150-25*t.x-(t.divIdx-1)%4*500+"px",top:150-25*t.y-500*(t.divIdx-1>>2)+"px"})}))}function a(){const t=e("#IDO > select[name^=dt_ido]"),n=e(".MapCourse").removeClass("Paw Top Right Bottom Left Final"),r=e(".MapCourseIco").removeClass("Pause Step Taxi");32*Math.random()<1&&e(".MapCourse").addClass("Paw");for(let e=0;e<5;e++)switch(t.eq(e).val()){case"0":r.eq(e).addClass("Pause");break;case"1":r.eq(e).addClass("Step"),n.eq(e).addClass("Top");break;case"2":r.eq(e).addClass("Step"),n.eq(e).addClass("Right");break;case"3":r.eq(e).addClass("Step"),n.eq(e).addClass("Bottom");break;case"4":r.eq(e).addClass("Step"),n.eq(e).addClass("Left");break;case"5":r.eq(e).addClass("Taxi"),n.eq(e).addClass("Final"),e=5}}t.divht={"チナミ":1,"ヒノデ":2,"マガサ":3,"ミナト":4,"カミセイ":5,"ウシ":6,"リュウジン":7,"アライ":8,"オオキタ":9,"カスミ":10,"コヌマ":11,"タニモリ":12,"シモヨメ":13,"ウラド":14,"ツクナミ":15,"マシカ":16},e("#IDO").after(o.a),e("select[name='dt_taxi']").on("change",r),e("select[name^=dt_ido]").on("change",a),yield r(),a()}))},function(t,n,r){var e=r(3);"string"==typeof e&&(e=[[t.i,e,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(5)(e,a);e.locals&&(t.exports=e.locals)},function(t,n,r){(t.exports=r(4)(!1)).push([t.i,'@charset "utf-8";\r\n\r\n#MiniMapCnt {\r\n    width: 325px;\r\n    height: 325px;\r\n    position: relative;\r\n    overflow: hidden;\r\n    white-space: nowrap;\r\n    line-height: 0;\r\n    background-color: rgb(32,0,0);\r\n}\r\n\r\n#MiniMap {\r\n    position: absolute;\r\n    left: 150px;\r\n    top: 150px;\r\n    border-collapse: collapse; border-spacing: 0;\r\n}\r\n\r\n#MiniMap td, #MiniMap th {\r\n    padding: 0;\r\n}\r\n\r\n#CntCourse {\r\n    width: 0;\r\n    height: 0;\r\n    position: absolute;\r\n    left: 150px;\r\n    top: 150px;\r\n    font-size: 25px;\r\n    line-height: 100%;\r\n    vertical-align: middle;\r\n}\r\n\r\n.MapCourse {\r\n    width: 25px;\r\n    height: 25px;\r\n    position: absolute;\r\n    top: 0px;\r\n    left: 0px;\r\n    pointer-events: none;\r\n}\r\n.MapCourse.Top > .MapCourse {\r\n    top: -25px;\r\n    left: 0px;\r\n}\r\n.MapCourse.Right > .MapCourse {\r\n    top: 0px;\r\n    left: 25px;\r\n}\r\n.MapCourse.Bottom > .MapCourse {\r\n    top: 25px;\r\n    left: 0px;\r\n}\r\n.MapCourse.Left > .MapCourse {\r\n    top: 0px;\r\n    left: -25px;\r\n}\r\n.MapCourse.Final > .MapCourse {\r\n    visibility: hidden;\r\n}\r\n\r\n.MapCourseIco::after {\r\n    display: inline-block;\r\n    width: 25px;\r\n    height: 25px;\r\n}\r\n.MapCourseIco.Pause::after {\r\n    content: "\\1F4A4";\r\n    color: transparent;\r\n    text-shadow: 0 0 0 aqua;\r\n}\r\n.MapCourseIco.Step::after {\r\n    content: "\\1F463";\r\n    color: transparent;\r\n    text-shadow: 0 0 0 orange;\r\n}\r\n.Paw .MapCourseIco.Step::after {\r\n    content: "\\1F43E";\r\n}\r\n.MapCourse.Right > .MapCourseIco.Step::after {\r\n    transform: rotate(90deg);\r\n}\r\n.MapCourse.Bottom > .MapCourseIco.Step::after {\r\n    transform: rotate(180deg);\r\n}\r\n.MapCourse.Left > .MapCourseIco.Step::after {\r\n    transform: rotate(270deg);\r\n}\r\n.MapCourseIco.Taxi::after {\r\n    content: "\\1F695";\r\n    color: inherit;\r\n    text-shadow: none;\r\n}\r\n.MapCourseIco.Goal::after {\r\n    content: "\\1F6A9";\r\n    color: inherit;\r\n    text-shadow: none;\r\n}\r\n\r\n#MapShadow {\r\n    width: 325px;\r\n    height: 325px;\r\n    position: absolute;\r\n    background-image: url(\'https://dl.dropboxusercontent.com/s/xq54yg6fw9bisnv/darkness50.png\');\r\n    pointer-events: none;\r\n}',""])},function(t,n,r){"use strict";t.exports=function(t){var n=[];return n.toString=function(){return this.map((function(n){var r=function(t,n){var r=t[1]||"",e=t[3];if(!e)return r;if(n&&"function"==typeof btoa){var a=(i=e,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),o=e.sources.map((function(t){return"/*# sourceURL="+e.sourceRoot+t+" */"}));return[r].concat(o).concat([a]).join("\n")}var i;return[r].join("\n")}(n,t);return n[2]?"@media "+n[2]+"{"+r+"}":r})).join("")},n.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var e={},a=0;a<this.length;a++){var o=this[a][0];null!=o&&(e[o]=!0)}for(a=0;a<t.length;a++){var i=t[a];null!=i[0]&&e[i[0]]||(r&&!i[2]?i[2]=r:r&&(i[2]="("+i[2]+") and ("+r+")"),n.push(i))}},n}},function(t,n,r){var e,a,o={},i=(e=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===a&&(a=e.apply(this,arguments)),a}),s=function(t,n){return n?n.querySelector(t):document.querySelector(t)},p=function(t){var n={};return function(t,r){if("function"==typeof t)return t();if(void 0===n[t]){var e=s.call(this,t,r);if(window.HTMLIFrameElement&&e instanceof window.HTMLIFrameElement)try{e=e.contentDocument.head}catch(t){e=null}n[t]=e}return n[t]}}(),c=null,l=0,u=[],d=r(6);function f(t,n){for(var r=0;r<t.length;r++){var e=t[r],a=o[e.id];if(a){a.refs++;for(var i=0;i<a.parts.length;i++)a.parts[i](e.parts[i]);for(;i<e.parts.length;i++)a.parts.push(x(e.parts[i],n))}else{var s=[];for(i=0;i<e.parts.length;i++)s.push(x(e.parts[i],n));o[e.id]={id:e.id,refs:1,parts:s}}}}function h(t,n){for(var r=[],e={},a=0;a<t.length;a++){var o=t[a],i=n.base?o[0]+n.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};e[i]?e[i].parts.push(s):r.push(e[i]={id:i,parts:[s]})}return r}function m(t,n){var r=p(t.insertInto);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var e=u[u.length-1];if("top"===t.insertAt)e?e.nextSibling?r.insertBefore(n,e.nextSibling):r.appendChild(n):r.insertBefore(n,r.firstChild),u.push(n);else if("bottom"===t.insertAt)r.appendChild(n);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var a=p(t.insertAt.before,r);r.insertBefore(n,a)}}function g(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var n=u.indexOf(t);n>=0&&u.splice(n,1)}function v(t){var n=document.createElement("style");if(void 0===t.attrs.type&&(t.attrs.type="text/css"),void 0===t.attrs.nonce){var e=function(){0;return r.nc}();e&&(t.attrs.nonce=e)}return b(n,t.attrs),m(t,n),n}function b(t,n){Object.keys(n).forEach((function(r){t.setAttribute(r,n[r])}))}function x(t,n){var r,e,a,o;if(n.transform&&t.css){if(!(o="function"==typeof n.transform?n.transform(t.css):n.transform.default(t.css)))return function(){};t.css=o}if(n.singleton){var i=l++;r=c||(c=v(n)),e=w.bind(null,r,i,!1),a=w.bind(null,r,i,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=function(t){var n=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",b(n,t.attrs),m(t,n),n}(n),e=k.bind(null,r,n),a=function(){g(r),r.href&&URL.revokeObjectURL(r.href)}):(r=v(n),e=M.bind(null,r),a=function(){g(r)});return e(t),function(n){if(n){if(n.css===t.css&&n.media===t.media&&n.sourceMap===t.sourceMap)return;e(t=n)}else a()}}t.exports=function(t,n){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(n=n||{}).attrs="object"==typeof n.attrs?n.attrs:{},n.singleton||"boolean"==typeof n.singleton||(n.singleton=i()),n.insertInto||(n.insertInto="head"),n.insertAt||(n.insertAt="bottom");var r=h(t,n);return f(r,n),function(t){for(var e=[],a=0;a<r.length;a++){var i=r[a];(s=o[i.id]).refs--,e.push(s)}t&&f(h(t,n),n);for(a=0;a<e.length;a++){var s;if(0===(s=e[a]).refs){for(var p=0;p<s.parts.length;p++)s.parts[p]();delete o[s.id]}}}};var y,C=(y=[],function(t,n){return y[t]=n,y.filter(Boolean).join("\n")});function w(t,n,r,e){var a=r?"":e.css;if(t.styleSheet)t.styleSheet.cssText=C(n,a);else{var o=document.createTextNode(a),i=t.childNodes;i[n]&&t.removeChild(i[n]),i.length?t.insertBefore(o,i[n]):t.appendChild(o)}}function M(t,n){var r=n.css,e=n.media;if(e&&t.setAttribute("media",e),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function k(t,n,r){var e=r.css,a=r.sourceMap,o=void 0===n.convertToAbsoluteUrls&&a;(n.convertToAbsoluteUrls||o)&&(e=d(e)),a&&(e+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */");var i=new Blob([e],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(i),s&&URL.revokeObjectURL(s)}},function(t,n){t.exports=function(t){var n="undefined"!=typeof window&&window.location;if(!n)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=n.protocol+"//"+n.host,e=r+n.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,n){var a,o=n.trim().replace(/^"(.*)"$/,(function(t,n){return n})).replace(/^'(.*)'$/,(function(t,n){return n}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(a=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:e+o.replace(/^\.\//,""),"url("+JSON.stringify(a)+")")}))}}]);